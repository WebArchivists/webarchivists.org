if(typeof jQuery.type!='function'){jQuery.extend({class2type:{},type:function(obj){return obj==null?String(obj):jQuery.class2type[toString.call(obj)]||"object";}});jQuery.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(i,name){jQuery.class2type["[object "+name+"]"]=name.toLowerCase();});}
jQuery.extend({VideoPress:{error:{messages:{age:"You are of insufficient age to view this video.",error:"Unable to download and play video",flash:"Error loading Flash on your system",freedom:'You do not have sufficient <a href="http://www.gnu.org/philosophy/free-sw.html">Freedom levels</a> to view this video.',incompatible:'VideoPress requires either HTML5 video or <a href="http://www.adobe.com/go/getflashplayer">Adobe Flash Player 10</a> or above for playback.',incapable:"Your device is incapable of playing the requested video.",network:"A network error prevented video download and playback"}},support:{flash:function(){if(typeof swfobject!=="undefined"&&swfobject.hasFlashPlayerVersion(jQuery.VideoPress.video.flash.min_version)){return true;}else{return false;}},html5Video:function(sourcetype){var v=document.createElement("video");if(!!v.canPlayType){if(jQuery.type(sourcetype)==="string"){return!!v.canPlayType(sourcetype).replace(/no/,"");}
return true;}else{return false;}}},data:[],analytics:{wpcom:{base_uri:"//stats.wordpress.com/v.gif?",params:function(guid,filetype){var data=jQuery.VideoPress.data[guid];if(!jQuery.isPlainObject(data)){return;}
var params={blog:data.blog,post:data.post,page_url:top.document.URL};if(filetype==="mp4"&&data.mp4&&data.mp4.size){params.video_fmt="fmt_"+data.mp4.size;}else{params.video_fmt="fmt_std";}
return params;},send:function(params){var beacon=new Image();beacon.src=jQuery.VideoPress.analytics.wpcom.base_uri+jQuery.param(params);beacon=null;}},ga:{is_active:function(){if((typeof _gaq!=="undefined")&&jQuery.type(_gaq)==="array"){return true;}else{return false;}}},impression:function(guid){var params=jQuery.VideoPress.analytics.wpcom.params(guid,"mp4");if(!jQuery.isPlainObject(params)){return;}
params.video_impression=1;jQuery.VideoPress.analytics.wpcom.send(params);},played:function(guid,filetype){var params=jQuery.VideoPress.analytics.wpcom.params(guid,filetype);if(!jQuery.isPlainObject(params)){return;}
params.video_play=1;jQuery.VideoPress.analytics.wpcom.send(params);if(jQuery.VideoPress.analytics.ga.is_active()){_gaq.push(["_trackEvent","Videos","Play"]);}},watched:function(guid,filetype,current_time,initial_time){if(jQuery.VideoPress.data[guid].playback===undefined){var start=0;if(initial_time!==undefined&&jQuery.type(initial_time)==="number"&&initial_time>0){if(current_time>initial_time){start=current_time-initial_time;}}
jQuery.VideoPress.data[guid].playback={last_observed:current_time,time_elapsed:start};}
var time_watched=current_time-jQuery.VideoPress.data[guid].playback.last_observed;if(time_watched>0){jQuery.VideoPress.data[guid].playback.time_elapsed+=time_watched;jQuery.VideoPress.data[guid].playback.last_observed=current_time;if(jQuery.VideoPress.data[guid].playback.time_elapsed>15){var params=jQuery.VideoPress.analytics.wpcom.params(guid,filetype);if(!jQuery.isPlainObject(params)){return;}
params.t=15;jQuery.VideoPress.analytics.wpcom.send(params);jQuery.VideoPress.data[guid].playback.time_elapsed-=15;}else if(current_time===jQuery.VideoPress.data[guid].duration){jQuery.VideoPress.analytics.wpcom.send(params);jQuery.VideoPress.data[guid].playback.time_elapsed=0;delete jQuery.VideoPress.data[guid].playback;}}}},requirements:{isSufficientAge:function(container_el,min_age){var birthday=new Date(parseInt(jQuery("select[name=year]",container_el).val()),parseInt(jQuery("select[name=month]",container_el).val()),parseInt(jQuery("select[name=day]",container_el).val()));var allowed_age=new Date(Date.now()-(1000*60*60*24*365*min_age));if(birthday>allowed_age){container_el.html('<p class="error" style="color:#fff;font-weight:bold">'+jQuery.VideoPress.error.messages.age+"</p>");}else{jQuery.VideoPress.video.play(container_el);}},allowedDomain:function(allowed_domains){if(jQuery.type(allowed_domains)==="array"){if(jQuery.inArray(top.document.location.hostname,allowed_domains)===-1){return false;}}
return true;}},video:{flash:{player_uri:"http://s0.videopress.com/player.swf?v=1.03",min_version:"10.0.0",params:{wmode:"direct",quality:"autohigh",seamlesstabbing:"true",allowfullscreen:"true",allowscriptaccess:"always",overstretch:"true"},expressinstall:"http://s0.videopress.com/playerProductInstall.swf",embedCallback:function(event){if(event.success===false){jQuery("#"+event.id).html("<p>"+jQuery.VideoPress.error.messages.flash+"</p>");}}},types:{mp4:'video/mp4; codecs="avc1.64001E, mp4a.40.2"',ogv:'video/ogg; codecs="theora, vorbis"'},canPlay:function(){if(jQuery.VideoPress.support.flash()){jQuery.VideoPress.video.playerSupport="flash";}else if(jQuery.VideoPress.support.html5Video()){if(jQuery.VideoPress.support.html5Video(jQuery.VideoPress.video.types.mp4)){jQuery.VideoPress.video.playerSupport="mp4";}else if(jQuery.VideoPress.support.html5Video(jQuery.VideoPress.video.types.ogv)){jQuery.VideoPress.video.playerSupport="ogv";}else{jQuery.VideoPress.video.playerSupport="html5";}}else{jQuery.VideoPress.video.playerSupport="";}},prepare:function(guid,config,count){var video=jQuery.VideoPress.data[guid][count];if(config.container===undefined||jQuery.type(video)!=="object"){return;}
var width=0;if(config.width!==undefined){width=config.width;}else{config.container.width();}
var height=0;if(config.height!==undefined){height=config.height;}else{config.container.height();}
var div_id="#v-"+guid+'-'+count;var parent_width=jQuery(div_id).parent().width();var diffw=0;var diffh=0;var ratio=0;if(width>parent_width){diffw=width-parent_width+11;ratio=(width*1.0)/(height*1.0);diffh=diffw/ratio;width-=diffw;height-=Math.round(diffh);}
if(width<60||height<60){width=400;height=300;}
jQuery.VideoPress.data[guid][count].dimensions={};if(0==ratio){jQuery.VideoPress.data[guid][count].dimensions.width=width;jQuery.VideoPress.data[guid][count].dimensions.height=height;}
else{jQuery.VideoPress.data[guid][count].dimensions.width=width-7;jQuery.VideoPress.data[guid][count].dimensions.height=height-Math.round(7/ratio);jQuery(div_id).width(width);jQuery(div_id).height(height+50);jQuery(div_id+"-placeholder").width(jQuery.VideoPress.data[guid][count].dimensions.width);jQuery(div_id+"-placeholder").height(jQuery.VideoPress.data[guid][count].dimensions.height);jQuery(div_id+"-placeholder img.videopress-poster").width(jQuery.VideoPress.data[guid][count].dimensions.width);jQuery(div_id+"-placeholder img.videopress-poster").height(jQuery.VideoPress.data[guid][count].dimensions.height);}
config.container.data("guid",guid);config.container.data("count",count);if(jQuery.VideoPress.video.playerSupport===undefined){jQuery.VideoPress.video.canPlay();}
if(config.freedom===true&&jQuery.type(video.ogv)==="string"){jQuery.VideoPress.video.insert(config.container,guid,count,video,"ogv",jQuery.VideoPress.data[guid][count].dimensions.width,jQuery.VideoPress.data[guid].dimensions.height);config.container.data("player","ogv");}else if(jQuery.VideoPress.video.playerSupport==="flash"){config.container.data("player","flash");config.container.append('<div id="v-'+guid+"-"+count+'-video">');}else if(jQuery.inArray(jQuery.VideoPress.video.playerSupport,["html5","mp4","ogv"])&&(jQuery.type(video.mp4.uri)==="string"||jQuery.type(video.ogv.uri)==="string")){var load_type="html5";if(jQuery.VideoPress.video.playerSupport==="mp4"&&video.mp4!==undefined&&jQuery.type(video.mp4.uri)==="string"){load_type="mp4";}else if(jQuery.VideoPress.video.playerSupport==="ogv"&&video.ogv!==undefined&&jQuery.type(video.ogv.uri)==="string"){load_type="ogv";}
jQuery.VideoPress.video.insert(config.container,guid,count,video,load_type,jQuery.VideoPress.data[guid][count].dimensions.width,jQuery.VideoPress.data[guid][count].dimensions.height);config.container.data("player",load_type);load_type=null;}else{config.container.html('<p class="videopress-error">'+jQuery.VideoPress.error.messages.incompatible+'</p>');return false;}
return true;},insert:function(container_el,guid,count,video_data,video_type,width,height){var video_id="v-"+guid+"-"+count+"-video";var video_el=jQuery("<video />");video_el.attr("id",video_id);video_el.attr("width",width);video_el.attr("height",height);video_el.attr("poster",video_data.poster);if(video_type==="ogv"){video_el.attr("preload","metadata");}else{video_el.attr("preload","none");}
video_el.attr("controls","true");video_el.attr("x-webkit-airplay","allow");if(video_type==="mp4"&&video_data.mp4!==undefined&&jQuery.type(video_data.mp4.uri)==="string"){video_el.attr("src",video_data.mp4.uri);}else if(video_type==="ogv"&&video_data.ogv!==undefined&&jQuery.type(video_data.ogv.uri)==="string"){video_el.attr("src",video_data.ogv.uri);}else{if(video_data.mp4!==undefined&&jQuery.type(video_data.mp4.uri)==="string"){video_el.append('<source src="'+video_data.mp4.uri+'" />');}
if(video_data.ogv!==undefined&&jQuery.type(video_data.ogv.uri)==="string"){video_el.append('<source src="'+video_data.ogv.uri+'" />');}}
if(video_data.tracks!==undefined){video_el.append(video_data.tracks);}
video_el.append('<p class="videopress-error">'+jQuery.VideoPress.error.messages.incompatible+"</p>");video_el.hide();container_el.append(video_el);video_el=null;video_id=null;},play:function(container_el){var player=container_el.data("player");if(player===undefined){player="flash";}
var guid=container_el.data("guid");var count=container_el.data("count");if(player==="flash"){jQuery("#"+container_el.attr("id")+"-placeholder",container_el).remove();swfobject.embedSWF(jQuery.VideoPress.video.flash.player_uri,"v-"+guid+"-"+count+"-video",jQuery.VideoPress.data[guid][count].dimensions.width,jQuery.VideoPress.data[guid][count].dimensions.height,jQuery.VideoPress.video.flash.min_version,jQuery.VideoPress.video.flash.expressinstall,{guid:guid,autoPlay:"true",isDynamicSeeking:"true",hd:jQuery.VideoPress.data[guid][count].hd},jQuery.VideoPress.video.flash.params,null,jQuery.VideoPress.video.flash.embedCallback);}else if(jQuery.inArray(player,["html5","mp4","ogv"])){var video_el=jQuery("video",container_el);if(video_el){jQuery("#"+container_el.attr("id")+"-placeholder",container_el).remove();if(player==="html5"){player="mp4";}
jQuery.VideoPress.video.playHTML5(video_el,guid,player);}}else{jQuery("#"+container_el.attr("id")+"-placeholder",container_el).remove();container_el.append('<p class="videopress-error">Unable to play video. No suitable player.</p>');}},playHTML5:function(video_el,guid,filetype){video_el.show();video_el[0].load();video_el[0].play();jQuery.VideoPress.analytics.played(guid,filetype);video_el.bind("error stalled",function(e){var message=jQuery.VideoPress.error.messages.error;try{switch(e.target.error.code){case e.target.error.MEDIA_ERR_NETWORK:message=jQuery.VideoPress.error.messages.network;break;case e.target.error.MEDIA_ERR_DECODE:case e.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:message=jQuery.VideoPress.error.messages.incapable+" "+filetype.toUpperCase()+".";break;default:break;}}catch(err){}
if(message.length>0){video_el.html('<p class="videopress-error">'+message+"</p>");}
message=null;});video_el.bind("durationchange",{guid:guid},function(event){var duration=jQuery(event.target).attr("duration");if(jQuery.type(duration)==="number"){jQuery.VideoPress.data[event.data.guid].duration=duration;}
duration=null;});video_el.one("loadeddata",{guid:guid,filetype:filetype},function(event){var filetype=event.data.filetype;var loaded_file=jQuery(event.target).attr("currentSrc");if(jQuery.type(loaded_file)==="string"&&loaded_file.length>3){var ext=loaded_file.substr(loaded_file.lastIndexOf(".")+1).toLowerCase();if(jQuery.inArray(ext,["mp4","ogv"])){filetype=ext;}
ext=null;}
video_el.bind("play",{guid:event.data.guid,filetype:filetype},function(event){jQuery.VideoPress.analytics.played(event.data.guid,event.data.filetype);});video_el.bind("timeupdate",{guid:event.data.guid,filetype:filetype},function(event){var target=jQuery(event.target);jQuery.VideoPress.analytics.watched(event.data.guid,event.data.filetype,target.attr("currentTime"),target.attr("initialTime"));target=null;});video_el.bind("ended",{guid:event.data.guid,filetype:filetype},function(event){jQuery.VideoPress.analytics.watched(event.data.guid,event.data.filetype,jQuery.VideoPress.data[guid].duration,jQuery(event.target).attr("initialTime"));});});}}}});